<%- include('../partials/header') %>

<!-- Hero Section -->
<section class="hero-section text-center text-white" style="background-color: #6c757d;">
    <div class="container py-5">
        <h1 class="display-4 fw-bold mb-4">Calcolo Fabbisogno Calorico</h1>
        <p class="lead mb-4">Scopri quante calorie assumere giornalmente in base al tuo stile di vita</p>
    </div>
</section>

<!-- Form Base -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow">
                    <div class="card-body">
                        <h2 class="text-center mb-4">Inserisci i tuoi dati</h2>
                        
                        <form id="calorieForm">
                            <div class="row g-3">
                                <!-- Sesso -->
                                <div class="col-md-6">
                                    <label class="form-label">Sesso</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sesso" id="maschio" value="maschio" checked>
                                        <label class="form-check-label" for="maschio">Maschio</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sesso" id="femmina" value="femmina">
                                        <label class="form-check-label" for="femmina">Femmina</label>
                                    </div>
                                </div>
                                
                                <!-- Età -->
                                <div class="col-md-6">
                                    <label for="eta" class="form-label">Età</label>
                                    <input type="number" class="form-control" id="eta" name="eta" min="15" max="100" required>
                                </div>
                                
                                <!-- Peso -->
                                <div class="col-md-6">
                                    <label for="peso" class="form-label">Peso (kg)</label>
                                    <input type="number" class="form-control" id="peso" name="peso" min="30" max="200" required>
                                </div>
                                
                                <!-- Altezza -->
                                <div class="col-md-6">
                                    <label for="altezza" class="form-label">Altezza (cm)</label>
                                    <input type="number" class="form-control" id="altezza" name="altezza" min="100" max="250" required>
                                </div>
                                
                                <!-- Attività Fisica -->
                                <div class="col-12">
                                    <label for="attivita" class="form-label">Livello di Attività Fisica</label>
                                    <select class="form-select" id="attivita" name="attivita" required>
                                        <option value="1.2">Sedentario (poco o nessun esercizio)</option>
                                        <option value="1.375">Leggermente attivo (esercizio leggero 1-3 giorni/settimana)</option>
                                        <option value="1.55">Moderatamente attivo (esercizio moderato 3-5 giorni/settimana)</option>
                                        <option value="1.725">Molto attivo (esercizio intenso 6-7 giorni/settimana)</option>
                                        <option value="1.9">Estremamente attivo (lavoro fisico pesante + esercizio intenso)</option>
                                    </select>
                                </div>
                                
                                <!-- Obiettivo -->
                                <div class="col-12">
                                    <label for="obiettivo" class="form-label">Obiettivo</label>
                                    <select class="form-select" id="obiettivo" name="obiettivo" required>
                                        <option value="-500">Perdere peso</option>
                                        <option value="0" selected>Mantenere peso</option>
                                        <option value="500">Aumentare peso</option>
                                    </select>
                                </div>
                                
                                <!-- Bottone Calcola -->
                                <div class="col-12 mt-4">
                                    <button type="submit" class="btn btn-success btn-lg w-100">Calcola Calorie</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Sezione Risultati -->
<section class="py-5 bg-light-green" id="resultsSection" style="display: none;">
    <div class="container text-center">
        <h3>Il tuo fabbisogno calorico giornaliero</h3>
        <div class="display-4 fw-bold my-3" id="calorieResult">0 kcal</div>
        <p class="text-muted" id="interpretationText"></p>
        
        <div class="mt-4">
            <h4>Dettagli</h4>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5>Metabolismo Basale</h5>
                            <p class="fs-4" id="metabolismoBasale">0 kcal</p>
                            <p class="small text-muted">Calorie necessarie a riposo</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Sezione Info -->
<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-info-circle fa-3x text-primary mb-3"></i>
                        <h5>Come viene calcolato?</h5>
                        <p>Il calcolo si basa sull'equazione di Mifflin-St Jeor, considerata la più accurata per stimare il metabolismo basale.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-balance-scale fa-3x text-primary mb-3"></i>
                        <h5>Metabolismo Basale</h5>
                        <p>Rappresenta le calorie necessarie per mantenere le funzioni vitali a riposo.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-fire-alt fa-3x text-primary mb-3"></i>
                        <h5>Termogenesi</h5>
                        <p>L'energia utilizzata per digerire il cibo e svolgere attività fisica.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Script per chiamata API -->
<script>
    document.getElementById('calorieForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Mostra loader
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Calcolando...';
        
        try {
            // Raccogli i dati dal form
            const formData = {
                sesso: document.querySelector('input[name="sesso"]:checked').value,
                eta: document.getElementById('eta').value,
                peso: document.getElementById('peso').value,
                altezza: document.getElementById('altezza').value,
                attivita: document.getElementById('attivita').value,
                obiettivo: document.getElementById('obiettivo').value
            };
            
            // Chiamata API
            const response = await fetch('/api/calorie', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });
            
            if (!response.ok) {
                throw new Error('Errore nel calcolo');
            }
            
            const data = await response.json();
            
            // Mostra i risultati
            document.getElementById('calorieResult').textContent = `${data.fabbisognoCalorico} kcal`;
            document.getElementById('metabolismoBasale').textContent = `${data.metabolismoBasale} kcal`;
            document.getElementById('interpretationText').textContent = data.interpretazione;
            document.getElementById('resultsSection').style.display = 'block';
            
            // Scroll ai risultati
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            
        } catch (error) {
            console.error('Errore:', error);
            alert('Si è verificato un errore durante il calcolo. Riprova più tardi.');
        } finally {
            // Ripristina il pulsante
            submitBtn.disabled = false;
            submitBtn.textContent = 'Calcola Calorie';
        }
    });
</script>

<%- include('../partials/footer') %>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>